!function(e){"use strict";function t(){e(document).off("click",".rtwpvg-add-image"),e(document).on("click",".rtwpvg-add-image",i),e(document).on("click",".rtwpvg-remove-image",o),e(document).on("click",".rtwpvg-media-video-popup",a),e(".woocommerce_variation").each(function(){var t=e(this).find(".options");e(this).find(".rtwpvg-gallery-wrapper").insertBefore(t)})}function i(t){t.preventDefault(),t.stopPropagation();var i=this,a=0,o=e(this).data("product_variation_id"),s=e(this).data("product_variation_loop");if("undefined"!=typeof wp&&wp.media&&wp.media.editor){if(a)return void a.open();(a=wp.media.frames.select_image=wp.media({title:rtwpvg_admin.choose_image,button:{text:rtwpvg_admin.add_image},library:{type:["image"]},multiple:!0})).on("select",function(){var t=a.state().get("selection").toJSON().map(function(e){if("image"===e.type){console.log(e);var t=e.id,i=e.rtwpvg_video_link,a=e.sizes,n=(a=void 0===a?{}:a).thumbnail,r=a.full,c=n?n.url:r.url;return wp.template("rtwpvg-image")({id:t,url:c,product_variation_id:o,loop:s,rtwpvg_video_link:i})}}).join("");e(i).parent().prev().find(".rtwpvg-images").append(t),r(),n(i)}),a.open()}}function a(t){t.preventDefault(),t.stopPropagation();var i=this,a=0;if("undefined"!=typeof wp&&wp.media&&wp.media.editor){if(a)return void a.open();(a=wp.media.frames.select_image=wp.media({title:rtwpvg_admin.choose_video,button:{text:rtwpvg_admin.add_video},library:{type:["video"]},multiple:!1})).on("select",function(){var t=a.state().get("selection").first().toJSON();console.log(t),"video"===t.type&&e(i).closest(".compat-attachment-fields").find(".compat-field-rtwpvg_video_link input").val(t.url).change()}),a.open()}}function o(t){t.preventDefault(),t.stopPropagation();var i=this;n(this),setTimeout(function(){e(i).parent().remove()},1)}function n(t){e(t).closest(".woocommerce_variation").addClass("variation-needs-update"),e("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),e("#variable_product_options").trigger("woocommerce_variations_input_changed")}function r(){e(".rtwpvg-images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"rtwpvg-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){n(this)}})}e.fn.wpColorPicker&&e("input.rtwpvg-color-picker").wpColorPicker(),e("#rtwpvg-settings-wrapper").on("click",".nav-tab",function(t){t.preventDefault();var i=e(this),a=i.data("target");if(i.addClass("nav-tab-active").siblings().removeClass("nav-tab-active"),e("#"+a).show().siblings().hide(),e("#_last_active_tab").val(a),history.pushState){var o=function(e,t){var i=window.location.href,a=location.hash;if((i=i.replace(a,"")).indexOf("?")>=0){var o=i.substring(i.indexOf("?")+1).split("&"),n=!1;o.forEach(function(i,a){var r=i.split("=");r[0]==e&&(o[a]=e+"="+t,n=!0)}),n||o.push(e+"="+t),i=i.substring(0,i.indexOf("?")+1)+o.join("&")}else i+="?"+e+"="+t;return i+a}("section",a);window.history.pushState({path:o},"",o)}}),e(".rtwpvg-setting-tab #license_key-wrapper").on("click",".rt-licensing-btn",function(t){t.preventDefault(),console.log("clicked");var i=e(this),a=i.hasClass("license_activate")?"license_activate":"license_deactivate";e.ajax({type:"POST",url:rtwpvg_admin.ajaxurl,data:{action:"rtwpvg_manage_licensing",type:a},beforeSend:function(){i.addClass("loading"),i.parents(".description").find(".rt-licence-msg").remove(),e('<span class="rt-icon-spinner animate-spin"></span>').insertAfter(i)},success:function(t){i.next(".rt-icon-spinner").remove(),i.removeClass("loading"),t.error||(i.text(t.value),i.removeClass(a),i.addClass(t.type),"license_deactivate"==t.type?(i.removeClass("button-primary"),i.addClass("danger")):"license_activate"==t.type&&(i.removeClass("danger"),i.addClass("button-primary"))),t.msg&&e("<span class='rt-licence-msg'>"+t.msg+"</span>").insertAfter(i),i.blur()},error:function(e,t){i.removeClass("loading"),i.next(".rt-icon-spinner").remove()}})}),e("#woocommerce-product-data").on("woocommerce_variations_loaded",function(){t(),r()}),e("#variable_product_options").on("woocommerce_variations_added",function(){t(),r()})}(jQuery);
