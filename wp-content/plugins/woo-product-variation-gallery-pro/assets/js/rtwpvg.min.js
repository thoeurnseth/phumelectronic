!function(i){"use strict";i.fn.rtWpVGallery=function(){return this._item=i(this),this._target=this._item.parent(),this._product=this._item.closest(".product"),this._default_gallery_images=[],this._variation_images=[],this._variation_form=this._product.find(".variations_form"),this._product_id=this._variation_form.data("product_id"),this._is_variation_product=!!this._variation_form.length,this._slider=i(".rtwpvg-slider",this._item),this._thumbnail=i(".rtwpvg-thumbnail-slider",this._item),this.is_vertical=!!rtwpvg.is_vertical,this.removeLoading=function(){this._item.removeClass("loading-rtwpvg")},this.addLoading=function(){this._item.addClass("loading-rtwpvg")},this.loadDefaultGalleryImages=function(){if(this._is_variation_product){var i=this;wp.ajax.send("rtwpvg_get_default_gallery_images",{data:{product_id:this._product_id},success:function(t){i._default_gallery_images=t,i._item.trigger("rtwpvg_default_gallery_image_loaded")},error:function(t){i._default_gallery_images=[],i._item.trigger("rtwpvg_default_gallery_image_loaded")}})}},this.loadSlider=function(){var t=this;try{this._slider.hasClass("slick-initialized")&&this._slider.slick("unslick")}catch(i){}this._slider.off("init"),this._slider.off("beforeChange"),this._slider.off("afterChange"),this._item.trigger("rtwpvg_before_init"),this._slider.on("init",function(i){t.initial_load&&(t.initial_load=!1)}).on("beforeChange",function(i,e,a,s){t._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").removeClass("current-thumbnail").eq(s).addClass("current-thumbnail")}).on("afterChange",function(i,e,a){t.stopVideo(t._slider),t.loadZoom(a)}).slick(),this._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").first().addClass("current-thumbnail"),this._thumbnail.find(".rtwpvg-thumbnail-image").not(".slick-slide").each(function(e,a){i(a).find("div, img").on("click",function(i){i.preventDefault(),i.stopPropagation(),t._slider.slick("slickGoTo",e)})}),rtwpvg.is_vertical&&rtwpvg.enable_thumbnail_slide&&(i(window).on("resize",t.setThumbnailPositionOnResize()),this._slider.on("setPosition",t.setThumbnailHeightOnSetPosition()),this._slider.on("afterChange",function(){t.setThumbnailHeight()}));var e=this._thumbnail.find(".rtwpvg-thumbnail-image");parseInt(rtwpvg.thumbnails_columns)<e.length&&rtwpvg.enable_thumbnail_slide?(e.removeClass("current-thumbnail"),this.loadThumbnailSlider()):this._slider.slick("slickSetOption","asNavFor",null,!1),setTimeout(function(){t._item.trigger("rtwpvg_slider_init")},1),setTimeout(function(){t.removeLoading()},100)},this.stopVideo=function(t){i(t).find("iframe, video").each(function(){var t=i(this).prop("tagName").toLowerCase();if("iframe"===t){var e=i(this).attr("src");i(this).attr("src",e)}"video"===t&&i(this)[0].pause()})},this.setThumbnailHeight=function(){this.is_vertical?this._slider.slick("getSlick").$slides.length>1?this._thumbnail.height(this._slider.height()):this._thumbnail.height(0):this._thumbnail.height("auto"),this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("setPosition")},this.setThumbnailHeightOnSetPosition=function(){var i=this;return this.setThumbnailHeight(),_.debounce(function(){i.setThumbnailHeight()},401)},this.setThumbnailPositionOnResize=function(){var i=this;return i.setThumbnailPosition(),_.debounce(function(){i.setThumbnailPosition()},400)},this.setThumbnailPosition=function(){rtwpvg.is_vertical&&(window.matchMedia("(max-width: 768px)").matches||window.matchMedia("(max-width: 480px)").matches?(this.is_vertical=!1,this._item.removeClass("rtwpvg-thumbnail-position-left rtwpvg-thumbnail-position-right rtwpvg-thumbnail-position-bottom"),this._item.addClass("rtwpvg-thumbnail-position-bottom"),this._slider.slick("setPosition")):(this.is_vertical=!0,this._item.removeClass("rtwpvg-thumbnail-position-left rtwpvg-thumbnail-position-right rtwpvg-thumbnail-position-bottom"),this._item.addClass("rtwpvg-thumbnail-position-"+rtwpvg.thumbnail_position),this._slider.slick("setPosition")))},this.loadThumbnailSlider=function(){var i=this;try{this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("unslick")}catch(i){}this._thumbnail.off("init"),this._thumbnail.on("init",function(){}).slick(),setTimeout(function(){i._item.trigger("rtwpvg_thumbnail_slider_init")},1)},this.callZoom=function(){var i=this._slider.slick("slickCurrentSlide");this.loadZoom(i)},this.loadZoom=function(t){if(rtwpvg.enable_zoom){var e=parseInt(this._target.width()),a=!1,s=this._slider.slick("getSlick").$slides.eq(t);if(i(s).each(function(t,s){var r=i(s).find("img");if(parseInt(r.data("large_image_width"))>e)return a=!0,!1}),i.fn.zoom&&a){var r=i.extend({touch:!1},wc_single_product_params.zoom_options);"ontouchstart"in document.documentElement&&(r.on="click"),s.trigger("zoom.destroy"),s.zoom(r)}}},this.loadPhotoSwipe=function(){var i=this;rtwpvg.enable_lightbox&&(this._item.off("click",".rtwpvg-trigger"),this._item.on("click",".rtwpvg-trigger",function(t){i.openPhotoSwipe(t)}))},this.openPhotoSwipe=function(t){if(t.preventDefault(),"undefined"==typeof PhotoSwipe)return!1;var e=this,a=i(".pswp")[0],s=this.getGalleryItems(),r=i.extend({index:this._slider.slick("slickCurrentSlide")},wc_single_product_params.photoswipe_options),o=new PhotoSwipe(a,PhotoSwipeUI_Default,s,r);o.listen("close",function(){e.stopVideo(a)}),o.listen("afterChange",function(){e.stopVideo(a)}),o.init()},this.getGalleryItems=function(){var t=this._slider.slick("getSlick").$slides,e=[];return t.length>0&&t.each(function(t,a){var s=i(a).find("img, iframe, video"),r=void 0;switch(i(s).prop("tagName").toLowerCase()){case"img":r={src:s.attr("data-large_image"),w:s.attr("data-large_image_width"),h:s.attr("data-large_image_height"),title:s.attr("data-caption")?s.attr("data-caption"):s.attr("title")};break;case"iframe":r={html:'<iframe class="rtwpvg-lightbox-iframe" src="'+s.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'};break;case"video":r={html:'<video class="rtwpvg-lightbox-video" controls controlsList="nodownload" src="'+s.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000"></video>'}}e.push(r)}),e},this.destroySlider=function(){this._slider.html(""),this._thumbnail.html("");try{this._slider.hasClass("slick-initialized")&&this._slider.slick("unslick"),this._thumbnail.hasClass("slick-initialized")&&this._thumbnail.slick("unslick")}catch(i){}this._item.trigger("rtwpvg_slider_destroy")},this.loadGallery=function(i){var t=this,e=i.length>1;this._item.trigger("before_rtwpvg_load",[i]),this.destroySlider();var a=i.map(function(i){return wp.template("rtwpvg-slider-template")(i)}).join(""),s=i.map(function(i){return wp.template("rtwpvg-thumbnail-template")(i)}).join("");this._slider.html(a),e?(this._target.addClass("rtwpvg-has-product-thumbnail"),this._thumbnail.html(s)):(this._target.removeClass("rtwpvg-has-product-thumbnail"),this._thumbnail.html("")),setTimeout(function(){t.imagesLoaded()},1)},this.resetGallery=function(){var i=this;this._default_gallery_images.length>0?this.loadGallery(this._default_gallery_images):setTimeout(function(){i.removeLoading()},100)},this.imagesLoaded=function(){var t=this;if(i.fn.imagesLoaded.done)return this._item.trigger("rtwpvg_image_loading",[t]),void this._item.trigger("rtwpvg_image_loaded",[t]);this._item.imagesLoaded().progress(function(i,e){t._item.trigger("rtwpvg_image_loading",[t])}).done(function(i){t._item.trigger("rtwpvg_image_loaded",[t])})},this.preloadVariationImages=function(){if(this._is_variation_product){var i=this;wp.ajax.send("rtwpvg_get_variation_images",{data:{product_id:this._product_id},success:function(t){i._variation_images=t},error:function(t){i._variation_images=[]}})}},this.loadVariationGallery=function(){var i=this;this._variation_form.off("reset_image.rtwpvg"),this._variation_form.off("click.rtwpvg"),this._variation_form.off("show_variation.rtwpvg"),rtwpvg.reset_on_variation_change?this._variation_form.on("reset_image.rtwpvg",function(t){i.addLoading(),i.resetGallery()}):this._variation_form.on("click.rtwpvg",".show_variation",function(t){i.addLoading(),i.resetGallery()}),this._variation_form.on("show_variation.rtwpvg",function(t,e){i.addLoading(),i.loadGallery(e.variation_gallery_images)})},this.loadEvents=function(){this._item.on("rtwpvg_image_loaded",this.init.bind(this))},this.init=function(i){var t=this;setTimeout(function(){t.loadSlider(),t.callZoom(),t.loadPhotoSwipe()},500)},this.start=function(){this.loadDefaultGalleryImages(),this.preloadVariationImages(),this.loadEvents(),this.is_variation_product&&(this.loadSlider(),this.callZoom(),this.loadPhotoSwipe()),this.is_variation_product||this.imagesLoaded(),this.loadVariationGallery(),this._variation_form.trigger("reload_product_variations"),i(document).trigger("rtwpvg_loaded")},this.start(),this},i(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery(),i(document).on("wc_variation_form",".variations_form",function(){i(".rtwpvg-wrapper").rtWpVGallery()}),i(document.body).on("post-load",function(){i(".rtwpvg-wrapper").rtWpVGallery()}),i(document).on("qv_loader_stop",function(){i(".rtwpvg-wrapper:not(.rtwpvg-product-type-variable)").rtWpVGallery()})}(jQuery);
