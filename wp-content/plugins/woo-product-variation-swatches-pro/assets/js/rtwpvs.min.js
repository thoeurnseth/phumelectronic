!function(t){"use strict";t.fn.rtWpvsVariationSwatchesForm=function(){return this._variation_form=t(this),this.product_variations=this._variation_form.data("product_variations"),this._is_ajax=!!this.product_variations,this._out_of_stock={},this._is_mobile=t("body").hasClass("rtwpvs-is-mobile"),this.start=function(){var a=this;this._variation_form.find(".rtwpvs-terms-wrapper").each(function(){var i=t(this),r=i.parent().find("select.rtwpvs-wc-select");i.on("touchstart click",".rtwpvs-term:not(.rtwpvs-radio-term)",function(i){i.preventDefault(),i.stopPropagation();var e=t(this),o=e.hasClass("selected"),s=e.data("term");o&&rtwpvs_params.reselect_clear&&(s=""),r.val(s).trigger("change").trigger("click").trigger("focusin"),a._is_mobile&&r.trigger("touchstart"),e.trigger("focus"),o?e.trigger("rtwpvs-unselected-term",[s,r,this._variation_form]):e.trigger("rtwpvs-selected-term",[s,r,this._variation_form])}),i.on("change","input.rtwpvs-radio-button-term:radio",function(i){i.preventDefault(),i.stopPropagation();var e=t(this),o=e.val(),s=e.parent(".rtwpvs-term.rtwpvs-radio-term"),n=s.hasClass("selected");n&&rtwpvs_params.reselect_clear&&(o=""),r.val(o).trigger("change").trigger("click").trigger("focusin"),a._is_mobile&&r.trigger("touchstart"),rtwpvs_params.reselect_clear?n?_.delay(function(){e.prop("checked",!1),s.trigger("rtwpvs-unselected-term",[o,r,this._variation_form])},1):s.trigger("rtwpvs-selected-term",[o,r,this._variation_form]):rtwpvs_params.reselect_clear||e.parent(".rtwpvs-term.rtwpvs-radio-term").removeClass("selected disabled").addClass("selected").trigger("rtwpvs-selected-term",[o,r,this._variation_form])}),rtwpvs_params.reselect_clear&&i.on("touchstart click","input.rtwpvs-radio-button-term:radio",function(a){a.preventDefault(),a.stopPropagation(),t(this).trigger("change")})}),setTimeout(function(){a._variation_form.trigger("reload_product_variations"),a._variation_form.trigger("rtwpvs_loaded",[a])},1)},this.update_trigger=function(){this._variation_form.on("rtwpvs_loaded",{that:this},this.loaded_triggered),this._variation_form.on("woocommerce_update_variation_values",this.update_variation_triggered),this._variation_form.on("reset_data",{that:this},this.reset_triggered),this._variation_form.on("woocommerce_variation_has_changed",{that:this},this.variation_has_changed_triggered)},this.update_variation_triggered=function(a){t(this).find(".rtwpvs-terms-wrapper").each(function(){var a=t(this),i=a.parent().find("select.rtwpvs-wc-select"),r=i.find("option:selected").val()||"",e=i.find("option:selected"),o=i.find("option").eq(1),s=[];i.find("option").each(function(){""!==t(this).val()&&(s.push(t(this).val()),r=e?e.val():o.val())}),setTimeout(function(){a.find(".rtwpvs-term").each(function(){var a=t(this),i=a.attr("data-term");a.removeClass("selected disabled").addClass("disabled"),-1!==s.indexOf(i)?(a.removeClass("disabled").find("input.rtwpvs-radio-button-term:radio").prop("disabled",!1),i===r&&a.addClass("selected").find("input.rtwpvs-radio-button-term:radio").prop("checked",!0)):a.find("input.rtwpvs-radio-button-term:radio").prop("disabled",!0).prop("checked",!1),i===r&&a.addClass("selected").find("input.rtwpvs-radio-button-term:radio").prop("disabled",!1).prop("checked",!0)}),a.trigger("rtwpvs-terms-updated")},1)})},this.variation_has_changed_triggered=function(a){a.data.that._is_ajax||t(this).find(".rtwpvs-terms-wrapper").each(function(){var a=t(this),i=a.parent().find("select.rtwpvs-wc-select"),r=i.find("option:selected").val()||"",e=i.find("option:selected"),o=i.find("option").eq(1),s=[];i.find("option").each(function(){""!==t(this).val()&&(s.push(t(this).val()),r=e?e.val():o.val())}),setTimeout(function(){a.find(".rtwpvs-term").each(function(){var a=t(this),i=a.attr("data-term");a.removeClass("selected disabled"),i===r&&a.addClass("selected").find("input.rtwpvs-radio-button-term:radio").prop("disabled",!1).prop("checked",!0)}),a.trigger("rtwpvs-terms-updated")},1)})},this.reset_triggered=function(a){a.data.that._is_ajax&&t(this).find(".rtwpvs-terms-wrapper").each(function(){t(this).find(".rtwpvs-term").removeClass("selected disabled").find("input.rtwpvs-radio-button-term:radio").prop("disabled",!1).prop("checked",!1)})},this.loaded_triggered=function(a){var i=a.data.that;if(i._is_ajax){var r={};i.product_variations.map(function(t){Object.keys(t.attributes).map(function(a){r[a]||(r[a]=[]),t.attributes[a]&&-1===r[a].indexOf(t.attributes[a])&&r[a].push(t.attributes[a])})}),t(a.target).find(".rtwpvs-terms-wrapper").each(function(){var a=t(this).data("attribute_name");t(this).find(".rtwpvs-term").each(function(){var i=t(this),e=i.attr("data-term");t.isEmptyObject(r)||-1!==r[a].indexOf(e)||i.removeClass("selected").addClass("disabled").find("input.rtwpvs-radio-button-term:radio").prop("disabled",!0).prop("checked",!1)})})}},this.start(),this.update_trigger(),this},t.fn.wc_set_variation_attr=function(t,a){void 0===this.attr("data-o_"+t)&&this.attr("data-o_"+t,this.attr(t)?this.attr(t):""),!1===a?this.removeAttr(t):this.attr(t,a)},t.fn.wc_reset_variation_attr=function(t){void 0!==this.attr("data-o_"+t)&&this.attr(t,this.attr("data-o_"+t))},t.fn.rtWpvsVariationSwatchesArchiveForm=function(){this._variation_form=t(this),this.product_variations=this._variation_form.data("product_variations"),this._attributeTerms=this._variation_form.find(".variations select"),this._is_ajax=!!this.product_variations,this._is_archive=this._variation_form.hasClass("rtwpvs-archive-variation-wrapper"),this._wrapper=this._variation_form.closest(rtwpvs_params.archive_product_wrapper),this._is_mobile=t("body").hasClass("rtwpvs-is-mobile"),this._image=this._wrapper.find(rtwpvs_params.archive_image_selector),this._cart_button=this._wrapper.find(".rtwpvs_add_to_cart"),this._cart_button_ajax=this._wrapper.find(".rtwpvs_ajax_add_to_cart"),this._cart_button_html=this._cart_button.clone().html(),this._price=this._wrapper.find(".price"),this._price_html=this._price.clone().html(),this._product_id=this._cart_button.data("product_id"),this.attributeData={},this.selectedData={},t.trim(rtwpvs_params.archive_add_to_cart_button_selector)&&(this._cart_button=this._wrapper.find(rtwpvs_params.archive_add_to_cart_button_selector),this._cart_button_ajax=this._wrapper.find(rtwpvs_params.archive_add_to_cart_button_selector)),this.setAttributeData=function(){var a=this;this._attributeTerms.each(function(){var i=t(this).data("attribute_name")||t(this).attr("data-attribute_name"),r=[];t(this).find(".rtwpvs-term").each(function(){r.push(t(this).data("term")||t(this).attr("data-term"))}),a.attributeData[i]=r})},this.setSelectedData=function(){var a=this;this._attributeTerms.each(function(){var i=t(this).data("attribute_name")||t(this).attr("name"),r=t(this).val()||"";a.selectedData[i]=r})},this.variation_changed=function(t){var a=t.data.variationForm,i=a.findMatchingVariations(a.product_variations,a.selectedData).shift();i?_.delay(function(){a._variation_form.trigger("found_variation.rtwpvs-archive-variation",[i]),a._variation_form.trigger("hide_variation"),a._variation_form.trigger("rtwpvs_archive_found_variation",[a,i])},50):(a._variation_form.trigger("update_variation_values.rtwpvs-archive-variation"),a._variation_form.trigger("reset_data.rtwpvs-archive-variation"))},this.resetArchiveVariation=function(){var t=this._wrapper.find(".price"),a=this._wrapper.find(".added_to_cart"),i=this._wrapper.find(".added_to_cart_button");t.html(this._price_html),this._cart_button.data("variation_id",""),this._cart_button.data("variation",""),rtwpvs_params.archive_swatches_enable_single_attribute||(rtwpvs_params.archive_add_to_cart_select_options?this._cart_button.html(rtwpvs_params.archive_add_to_cart_select_options):wc_add_to_cart_variation_params.i18n_select_options.trim()&&this._cart_button.text(wc_add_to_cart_variation_params.i18n_select_options),"no"===wc_add_to_cart_variation_params.enable_ajax_add_to_cart&&this._cart_button.prop("href",this._cart_button.data("product_permalink"))),this._cart_button.removeClass("added"),a.length>0&&a.remove(),i.length>0&&i.remove()},this.initVariationURL=function(){var a=this,i=new URL(window.location.toString()),r=i.searchParams.toString(),e=i.origin+i.pathname;this._variation_form.on("check_variations.wc-variation-form",function(o){var s=void 0;rtwpvs_params.has_wc_bundles?(i=new URL(window.location.toString()),r=i.searchParams.toString(),s=a.getChosenAttributesBundleSupport()):s=a.getChosenAttributes();var n=Object.keys(s).reduce(function(t,a){return s[a]&&(t[a]=s[a]),t},{}),_=a.urlParamsToObj(r),c=Object.assign({},_,n),d=t.param(c);window.history.pushState({},"",a.setUrlParams(e,d))})},this.init_trigger=function(){if(this._is_archive){var a=this;this._variation_form.on("found_variation.rtwpvs-archive-variation",{variationForm:this._variation_form},function(i,r){i.stopPropagation(),a.variationsImageUpdate(r);var e="",o=a._wrapper.find(".added_to_cart"),s=a._wrapper.find(".added_to_cart_button"),n=a._wrapper.find(".price");if(e=(e=(e=(r.variation_is_visible?wp.template("rtwpvs-variation-template"):wp.template("unavailable-variation-template"))({variation:r,price_html:t(r.price_html).unwrap().html()||a._price_html})).replace("/*<![CDATA[*/","")).replace("/*]]>*/",""),n.html(e),a._cart_button.data("variation_id",r.variation_id),a._cart_button.data("variation",a.getChosenAttributes()),!rtwpvs_params.archive_swatches_enable_single_attribute&&(rtwpvs_params.archive_add_to_cart_text?a._cart_button.html(rtwpvs_params.archive_add_to_cart_text):wc_add_to_cart_variation_params.i18n_add_to_cart.trim()&&a._cart_button.text(wc_add_to_cart_variation_params.i18n_add_to_cart),"no"===wc_add_to_cart_variation_params.enable_ajax_add_to_cart)){var _=t.param(Object.assign({},{"add-to-cart":a._product_id,variation_id:r.variation_id}));a._cart_button.prop("href",a.setUrlParams(a._cart_button.data("add_to_cart_url"),_))}a._cart_button.removeClass("added"),o.length>0&&o.remove(),s.length>0&&s.remove()}),this._variation_form.on("reset_image.rtwpvs-archive-variation",{variationForm:this._variation_form},function(t){a.variationsImageUpdate(!1)}),this._variation_form.on("reset_data.rtwpvs-archive-variation",{variationForm:this._variation_form},function(t){a.resetArchiveVariation()})}else rtwpvs_params.enable_variation_url&&this.initVariationURL();this._cart_button_ajax.off("click.rtwpvs-archive-add-to-cart"),this._cart_button_ajax.on("click.rtwpvs-archive-add-to-cart",function(a){var i=t(this);if(rtwpvs_params.archive_swatches_enable_single_attribute)return!0;if(!i.data("variation_id"))return!0;a.preventDefault(),a.stopPropagation(),i.removeClass("added").addClass("loading");var r={action:"rtwpvs_add_variation_to_cart"};t.each(i.data(),function(t,a){r[t]=a}),t(document.body).trigger("adding_to_cart",[i,r]),t.post(wc_add_to_cart_variation_params.ajax_url.toString(),r,function(a){a&&(a.error&&a.product_url?window.location=a.product_url:"yes"!==wc_add_to_cart_params.cart_redirect_after_add?t(document.body).trigger("added_to_cart",[a.fragments,a.cart_hash,i]):window.location=wc_add_to_cart_params.cart_url)})})},this.setUrlParams=function(t,a){if(a){a=(a=a.trim().replace(/^(\?|#|&)/,"").replace(/(\?|#|&)$/,""))?"?"+a:a;var i=t.split(/[\?\#]/)[0];a&&/\:\/\/[^\/]*$/.test(i)&&(i+="/");var r=t.match(/(\#.*)$/);t=i+a,r&&(t+=r[0])}return t},this.urlParamsToObj=function(t){for(var a=Array.from(new URLSearchParams(t).keys()),i={},r=0;r<a.length;r++){var e=a[r];i[e]=new URLSearchParams(t).get(e)}return i},this.init=function(){this.init_trigger();var a=this;_.delay(function(){a.setDefaultImages(),a._variation_form.trigger("rtwpvs_archive_init",[a,a.product_variations]),t(document).trigger("rtwpvs_archive_init_loaded",[a._variation_form,a.product_variations])},2)},this.setDefaultImages=function(){var a=this;_.delay(function(){a._variation_form.find(".rtwpvs-terms-wrapper > .rtwpvs-term:not(.disabled)").each(function(i,r){t(this).off("rtwpvs-selected-item.archive-image-hover"),t(this).off("rtwpvs-selected-item.archive-image-click"),t(this).off("mouseenter.archive-image-hover"),t(this).off("mouseleave.archive-image-hover"),"hover"===rtwpvs_params.archive_swatches_display_event&&t(this).on("mouseenter.archive-image-hover",function(i){i.stopPropagation(),t(this).trigger("click").trigger("focusin"),a._is_mobile&&t(this).trigger("touchstart")})})},2)},this.variationsImageUpdate=function(a){var i=this._wrapper.find(rtwpvs_params.archive_image_selector);i.addClass("rtwpvs-image-load").one("webkitAnimationEnd oanimationend msAnimationEnd animationend webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){t(this).removeClass("rtwpvs-image-load")}),a&&a.image&&a.image.thumb_src&&a.image.thumb_src.length>1?(i.wc_set_variation_attr("src",a.image.thumb_src),i.wc_set_variation_attr("height",a.image.thumb_src_h),i.wc_set_variation_attr("width",a.image.thumb_src_w),i.wc_set_variation_attr("srcset",a.image.thumb_srcset),i.wc_set_variation_attr("sizes",a.image.thumb_sizes),i.wc_set_variation_attr("title",a.image.title),i.wc_set_variation_attr("alt",a.image.alt)):(i.wc_reset_variation_attr("src"),i.wc_reset_variation_attr("width"),i.wc_reset_variation_attr("height"),i.wc_reset_variation_attr("srcset"),i.wc_reset_variation_attr("sizes"),i.wc_reset_variation_attr("title"),i.wc_reset_variation_attr("alt"))},this.isMatch=function(t,a){var i=!0;for(var r in t)if(t.hasOwnProperty(r)){var e=t[r],o=a[r];void 0!==e&&void 0!==o&&0!==e.length&&0!==o.length&&e!==o&&(i=!1)}return i},this.findMatchingVariations=function(t,a){for(var i=[],r=0;r<t.length;r++){var e=t[r];this.isMatch(e.attributes,a)&&i.push(e)}return i},this.getChosenAttributesBundleSupport=function(){var a={};return this._attributeTerms.each(function(){var i=t(this).attr("name");a[i]=t(this).val()||""}),a},this.getChosenAttributes=function(){var a={};return this._attributeTerms.each(function(){var i=t(this).data("attribute_name")||t(this).attr("name");a[i]=t(this).val()||""}),a},this.init(),t(document).trigger("rtwpvs_archive",[this._variation_form])},t(document).on("wc_variation_form",".variations_form",function(){t(this).rtWpvsVariationSwatchesForm(),t(this).rtWpvsVariationSwatchesArchiveForm()}),t(document.body).on("post-load",function(){t(".variations_form").each(function(){t(this).wc_variation_form()})}),t(document).on("yith_infs_added_elem",function(){t(".variations_form").each(function(){t(this).wc_variation_form()})}),t(document).on("yith-wcan-ajax-filtered",function(){t(".variations_form").each(function(){t(this).wc_variation_form()})}),t(document).on("wood-images-loaded",function(){t(".variations_form").each(function(){t(this).wc_variation_form()})}),t(document).on("berocket_ajax_products_loaded",function(){t(".variations_form").each(function(){t(this).wc_variation_form()})}),t(".shop-container .products").on("append.infiniteScroll",function(a,i,r){t(".variations_form").each(function(){t(this).wc_variation_form()})}),t(document).on("facetwp-loaded",function(){t(".variations_form").each(function(){t(this).wc_variation_form()})}),t("body").on("aln_reloaded",function(){_.delay(function(){t(".variations_form").each(function(){t(this).wc_variation_form()})},100)})}(jQuery);
